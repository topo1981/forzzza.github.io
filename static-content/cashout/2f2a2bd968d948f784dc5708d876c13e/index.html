$(function(){$("#mainContent").on("click","#openBetsTab, #closedBetsTab",function(){closeAllOpenPopups()});$("#mainContent").on("click","button.bs-cashout",function(a){var c=$(a.target);var b=c.parent();if(b.is("button.bs-cashout")){c=b}CashoutHandler.confirmCashout(c)})});var CashoutHandler=(function(){var l=null;function e(t,r){if(typeof(t)==="undefined"||t===null){return}var s="tw-info tw-msg-info2";var v=t.type;var u=(v===5);if(u){s="tw-info tw-msg-question-circle"}else{if(v===2){s="tw-info tw-msg-warning"}else{if(v===3){s="tw-info tw-msg-check-circle2"}else{if(v===4){s="tw-info tw-msg-warning3"}}}}var p=$('<div id="coTempPopup"></div>');var o=$('<ul id="cashoutPopup" data-role="listview"><li data-role="list-divider" data-theme="b" style="text-indent:1em;">'+"%cashout.mainTitle".toLocaleString()+"</li></ul>");o.append('<li><div id="coInfoPanel" class="'+s+'"></div><div id="coInfo" class="tw-popup-box">'+t.msg+"</div></li>");if(u){o.append('<li data-role="fieldcontain"><input type="checkbox" id="coConfirm" name="coConfirm" data-theme="a" data-mini="true" /><label for="coConfirm">'+"%cashout.acceptChange".toLocaleString()+"</label></li>");var q=$('<li><input type="button" data-mini="true" data-theme="c" data-icon="check" onclick="CashoutHandler.cashoutBetSlip();" data-iconpos="right" value="'+"%csButton.yes".toLocaleString()+'" /></li>').appendTo(o);var n=$('<li><input type="button" onclick="CashoutHandler.close();" data-mini="true" data-theme="h" data-icon="delete" data-iconpos="right" value='+"%csButton.cancel".toLocaleString()+" /></li>").appendTo(o)}else{if(v===h.Success){$('<li><input type="button" data-mini="true" data-theme="c" data-icon="refresh" onclick="TwNavigation.forceReload();" data-iconpos="right" value="'+"%csButton.close".toLocaleString()+'" /></li>').appendTo(o)}else{if(v===h.Error){$('<li><input type="button" data-mini="true" data-theme="f" data-icon="refresh" onclick="TwNavigation.forceReload();" data-iconpos="right" value="'+"%csButton.close".toLocaleString()+'" /></li>').appendTo(o)}else{$('<li><input type="button" data-mini="true" data-theme="e" data-icon="delete" onclick="CashoutHandler.close();" data-iconpos="right" value="'+"%csButton.close".toLocaleString()+'" /></li>').appendTo(o)}}}o.appendTo(p);$("<div>").mdialog({content:p.html(),popDismissable:false,useCustomClose:true,customCloseClass:"tw-custom-close"})}function a(){l.accept=$("#coConfirm").is(":checked");c();k(l.isLive);f(l).done(function(n){console.info(n)})}function m(o){if(!i(o.bsid)||!i(o.token)){return false}if(typeof(o.bsid)==="number"){if(o.bsid<=0){return false}}else{if(!(/^[0-9]{1,20}$/.test(o.bsid))){return false}}if(!(/^[0-9a-z]{32}$/.test(o.token))){return false}if(typeof(o.amount)==="number"){if(o.amount<=0){return false}}else{var n=j(o.amount,-1);if(n<=0){return false}}return true}function j(n,o){var q=o;if(i(n)&&n.length>0){var r=n.replace(",",".");if((/^\d+(\.\d{0,2})?$/.test(r))&&(r.length>0)){if(!isNaN(r)&&isFinite(r)){var p=parseFloat(r);if(p>0){q=p}}}}return q}function d(o){l=null;var n=$(o);var q={bsid:n.data("cid"),token:n.data("ctoken"),amount:n.data("camount"),isLive:(n.data("live")===1)};var r=m(q);if(!r){return}l=q;BetslipTimer.init();var p={msg:("%cashout.confirm".toLocaleString()).twformat(q.amount,"â‚¬"),type:h.Confirmation};e(p,q)}function c(){$("div.ui-popup").popup("close")}function i(n){if(typeof(n)!=="undefined"&&n!==null){return true}return false}function k(n){$("div.ui-popup-active").remove();$("#betslipLoader").removeClass("hide");if(n){BetslipTimer.start()}}function g(){setTimeout(function(){$("#betslipLoader").addClass("hide")},200)}function f(n){return $.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"cash-out",data:n,beforeSend:function(o){if(!n.isLive){$.mobile.loading("show")}}}).then(function(s){if(!i(s)||!i(s.d)){return($.Deferred().reject(s))}var q=s.d;if(q.rs>0){if(i(q.lurl)){twRouter.navigate(q.lurl,{trigger:true})}return($.Deferred().reject(s))}var r=q.cost;var p=(i(q.coim)?q.coim:"");var t={msg:p,type:h.ValidationError};if(r===b.Success){t.type=h.Success;$("#ubs-"+n.bsid).remove();if(i(q.uab)){$("#fAccbalance").html(q.uab)}}else{if(r===b.Changed){t.type=h.Info;if(i(q.ccoa)){var o=$("#bsco-"+n.bsid);o.data("camount",q.ccoa);o.data("ctoken",q.coh);o.find(".co-amount").html(q.ccoa)}}else{if(r===b.Failed){$("#bsco-"+n.bsid).remove()}}}e(t);return(s)},function(q,p,o){twRouter.navigate("error",{trigger:true});return($.Deferred().reject())}).always(function(o){if(!n.isLive){$.mobile.loading("hide")}else{g()}})}var b={Unknown:0,Success:1,Changed:2,Failed:3};var h={None:0,Info:1,Error:2,Success:3,ValidationError:4,Confirmation:5};return{confirmCashout:d,displayMessage:e,cashoutBetSlip:a,close:c}})();