(function(){function f(h){h&&(h=h.replace(/:[0-9]{1,5}/,""));return h}function F(h,k){d.closeFrame();g();var l=document.getElementById("wirecard-hpp-form");l&&l.parentNode.removeChild(l);k&&(J(),d.appendFrame(),h.embedded=!0,h.merchant_origin=G());l=o({formId:"wirecard-hpp-form",requestData:h,action:"https://api.wirecard.com:443/engine/hpp/",target:k?"wirecard-hpp-frame":"_self"});document.body.appendChild(l);l.submit()}function K(){if(-1===document.body.className.indexOf("wirecard-hpp-noscroll")){var h=H();h?(j||(j=h.getAttribute("content")),h.setAttribute("content","width\x3ddevice-width, initial-scale\x3d1, minimum-scale\x3d1, maximum-scale\x3d1.2")):(h=document.createElement("meta"),h.setAttribute("name","viewport"),h.setAttribute("content","width\x3ddevice-width, initial-scale\x3d1, minimum-scale\x3d1, maximum-scale\x3d1.2"),document.getElementsByTagName("head")[0].appendChild(h));document.body.className+=" wirecard-hpp-noscroll"}}function D(){var h=H();h&&h.setAttribute("content",j?j:"");document.body.className=document.body.className.replace(" wirecard-hpp-noscroll","")}function J(){if(!document.getElementById("wirecard-hpp-glass")){var h=document.createElement("div");h.setAttribute("id","wirecard-hpp-glass");document.body.appendChild(h);setTimeout(function(){h.setAttribute("class","wirecard-hpp-smoke-bg");L(h)},500)}}function g(){var h=document.getElementById("wirecard-hpp-glass");h&&h.parentNode.removeChild(h)}function L(h){setTimeout(function(){var k=document.createElement("div");k.setAttribute("id","wirecard-hpp-loading");h.appendChild(k)},250)}function E(){setTimeout(function(){var h=document.getElementById("wirecard-hpp-loading");h&&h.parentNode.removeChild(h)},750)}function H(){var h=null,k=document.getElementsByTagName("meta");for(i=0;i<k.length;i++){if("viewport"==k[i].getAttribute("name")){h=k[i];break}}return h}function I(h){window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent&&window.attachEvent("onmessage",h)}function G(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function M(h,k){var l=document.getElementById("wirecard-hpp-alert");l||(l=a("wirecard-hpp-error-template"),document.body.appendChild(l));document.getElementById("wirecard-hpp-alert-title").innerHTML=h;document.getElementById("wirecard-hpp-alert-msg").innerHTML=k;l.style.display="block"}function a(h){var k=document.createElement("div");k.setAttribute("id","wirecard-hpp-alert");var m=document.createElement("div");m.className=h;k.appendChild(m);var l=document.createElement("div");l.id="wirecard-hpp-alert-title";m.appendChild(l);l=document.createElement("div");l.id="wirecard-hpp-alert-msg";m.appendChild(l);l=document.createElement("button");l.innerHTML="Close";l.id="wirecard-hpp-alert-close-btn";l.className=h;l.onclick=function(){g();D();k.style.display="none"};m.appendChild(l);return k}function o(h){var k=document.getElementById(h.formId);k&&k.parentNode.removeChild(k);k=document.createElement("form");k.setAttribute("id",h.formId);k.setAttribute("method","POST");k.setAttribute("action",h.action);k.setAttribute("target",h.target);if("object"===typeof h.requestData){for(var m in h.requestData){if(h.requestData.hasOwnProperty(m)){var l=document.createElement("input");l.setAttribute("type","hidden");l.setAttribute("name",m);l.setAttribute("value",h.requestData[m]);k.appendChild(l)}}}return k}function b(h){var k="";if("object"===typeof h){for(var l in h){k+=encodeURIComponent(l)+"\x3d"+encodeURIComponent(h[l])+"\x26"}}return k?k.substring(0,k.length-1):k}function c(h){var k=document.createElement("form");k.setAttribute("action",h.url);k.setAttribute("method",h.method);if(h.payload){for(var m in h.payload){if(h.payload.hasOwnProperty(m)){var l=document.createElement("input");l.setAttribute("type","hidden");l.setAttribute("name",m);l.setAttribute("value",h.payload[m]);k.appendChild(l)}}}document.body.appendChild(k);k.submit()}window.WirecardPaymentPage={};window.WirecardHPP={};window.ElasticPaymentPage=window.WirecardPaymentPage;(function(){var h=navigator.userAgent.toLowerCase();return -1!=h.indexOf("msie")?parseInt(h.split("msie")[1]):!1})();var j=null;(function(){var h=document.createElement("link");h.setAttribute("rel","stylesheet");h.setAttribute("href","https://api.wirecard.com:443/engine/skin/default/embeddedLoader.css");document.getElementsByTagName("head")[0].appendChild(h)})();WirecardPaymentPage.embeddedPay=function(h){F(h,d.isAllowed())};WirecardPaymentPage.hostedPay=function(h){F(h,!1)};WirecardHPP.pay=function(h){WirecardPaymentPage.embeddedPay(h)};WirecardPaymentPage.seamlessRenderForm=function(h){e.renderForm(h)};WirecardPaymentPage.seamlessSubmitForm=function(h){e.submitForm(h)};WirecardPaymentPage.seamlessPay=function(h){e.pay(h)};WirecardPaymentPage.seamlessChangeLocale=function(h){e.changeLocale(h)};WirecardPaymentPage.seamlessValidateForm=function(h){e.validate(h)};WirecardPaymentPage.seamlessFormIsValid=function(h){e.isValid(h)};WirecardPaymentPage.confirmOrder=function(h){h=o({formId:"wirecard-confirm-order",requestData:h,action:"https://api.wirecard.com:443/engine/hpp/confirmOrder/",target:"_self"});document.body.appendChild(h);h.submit()};var d=function(){var h=function(k){"string"===typeof k.data&&(f(k.origin)===f("https://api.wirecard.com:443")?"wirecardHppCloseIframe"===k.data?(d.closeFrame(),g(),D()):"wirecardHppReady"===k.data?(K(),E()):/^wirecardHppJSfunction:/.test(k.data)?(D(),d.closeFrame(),E(),setTimeout(g,2000),eval("("+decodeURI(k.data.replace(/^wirecardHppJSfunction:/,""))+")()")):-1<k.data.indexOf("wirecardHppRedirect")&&c(JSON.parse(k.data).wirecardHppRedirect):-1<k.data.indexOf("wirecardHpp")&&(E(),d.closeFrame(),M("Error","Message processing failed due to the unexpected origin. Expected: "+f("https://api.wirecard.com:443")+" but was: "+f(k.origin))))};return{isAllowed:function(){return !(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||500>screen.width||500>screen.height)},appendFrame:function(){I(h);var k=document.createElement("div");k.id="wirecard-hpp-container";k.innerHTML='\x3ciframe id\x3d"wirecard-hpp-frame" name\x3d"wirecard-hpp-frame" allowTransparency\x3d"true" frameborder\x3d"0"\x3e\x3c/iframe\x3e';document.body.appendChild(k);document.getElementById("wirecard-hpp-frame").focus()},closeFrame:function(){window.removeEventListener?window.removeEventListener("message",h,!1):window.detachEvent&&window.detachEvent("onmessage",h);var k=document.getElementById("wirecard-hpp-container");k&&k.parentNode.removeChild(k)}}}(),e=function(){var l=function(h){this.requestId=h.requestData.request_id;this.wrappingDivId=h.wrappingDivId;this.successCallback=h.onSuccess;this.errorCallback=h.onError;this.requestTimeoutId=-1;this.state=this.step=0;this.formId="wd-seamless-form-"+h.requestData.request_id;this.frameId="wd-seamless-frame-"+h.requestData.request_id},n=function(){var h=[],k=function(){return h.length};return{size:k,getByRequestId:function(m){if(m){for(var u=0;u<h.length;u++){if(h[u].requestId==m){return h[u]}}}return null},getByWrappingDivId:function(m){if(m){for(var u=0;u<h.length;u++){if(h[u].wrappingDivId==m){return h[u]}}}return null},getFirst:function(){return 0<k()?h[0]:null},addOrReplace:function(v){for(var m=-1,u=0;u<h.length;u++){if(h[u].wrappingDivId==v.wrappingDivId){m=u;break}}-1<m&&h.splice(m,1);v=new l(v);h.push(v);return v},each:function(m){for(var u=0;u<h.length;u++){m(h[u])}}}}(),q=function(k,h){var v=null;1==n.size()?v=n.getFirst():k.wrappingDivId&&(v=n.getByWrappingDivId(k.wrappingDivId));var m=!1;if(v){if(1==v.state){if(k.onValidationResult){k.onValidationResult({form_validation_error:"Unable to process request because there is another request in progress."})}return}var u=document.getElementById(v.frameId);u&&u.contentWindow&&u.contentWindow.postMessage&&(v.validationCallback=k.onValidationResult,u.contentWindow.postMessage(JSON.stringify({WDEEMSG:{seamlessRequest:{operation:h}}}),"https://api.wirecard.com:443"),m=!0)}if(!m&&k.onValidationResult){k.onValidationResult({form_validation_error:"Unable to find seamless form"})}},p=function(k){var h;if(k.errorCallback||k.instance&&k.instance.errorCallback){h=k.errorCallback||k.instance.errorCallback}if(h){var m={loader_error:k.loaderError};if(k.requestId||k.instance&&k.instance.requestId){m.request_id=k.requestId||k.instance.requestId}if(k.wrappingDivId||k.instance&&k.instance.wrappingDivId){m.wrappingDivId=k.wrappingDivId||k.instance.wrappingDivId}h(m)}},r=function(k,h,m){h.requestTimeoutId=setTimeout(function(){h.state=3;p({loaderError:k,instance:h})},1000*m)},s=function(h){return{transaction_state:"failed",status_code_1:"N/A",status_description_1:h}},t=function(k){if(k&&k.data){var h=null;try{h=JSON.parse(k.data)}catch(m){}h&&f(k.origin)==f("https://api.wirecard.com:443")&&h.WDEEMSG&&h.WDEEMSG.seamlessResponse&&(k=n.getByRequestId(h.WDEEMSG.seamlessResponse.request_id))&&(1==k.state?(clearTimeout(k.requestTimeoutId),"success"==h.WDEEMSG.seamlessResponse.transaction_state?(k.state=2,1==k.step&&(document.getElementById(k.frameId).style.display="block",document.getElementById(k.frameId).focus()),k.successCallback&&k.successCallback(h.WDEEMSG.seamlessResponse)):(k.state=3,k.errorCallback&&k.errorCallback(h.WDEEMSG.seamlessResponse))):1==k.step&&2==k.state&&(k.submitSuccessCallback||k.submitErrorCallback)&&h.WDEEMSG.seamlessResponse.transaction_state?(k.step=2,"success"==h.WDEEMSG.seamlessResponse.transaction_state?k.submitSuccessCallback&&k.submitSuccessCallback(h.WDEEMSG.seamlessResponse):(k.state=3,k.submitErrorCallback&&k.submitErrorCallback(h.WDEEMSG.seamlessResponse))):k.validationCallback&&h.WDEEMSG.seamlessResponse.form_validation_result?k.validationCallback(h.WDEEMSG.seamlessResponse):k.customMessageCallback&&h.WDEEMSG.seamlessResponse.custom_message&&k.customMessageCallback(h.WDEEMSG.seamlessResponse.custom_message))}};return{renderForm:function(k){if(k&&k.wrappingDivId&&k.onSuccess&&k.onError&&k.requestData&&k.requestData.request_id){var h=document.getElementById(k.wrappingDivId);if(h){if(n.getByRequestId(k.requestData.request_id)){p({loaderError:"Request ID already in use.",requestId:k.requestData.request_id,wrappingDivId:k.wrappingDivId,errorCallback:k.onError})}else{var m=n.getByWrappingDivId(k);m&&1==m.state?p({loaderError:"Unable to process request because there is another request in progress.",requestId:k.requestData.request_id,wrappingDivId:k.wrappingDivId,errorCallback:k.onError}):(0==n.size()&&I(t),m=n.addOrReplace(k),m.step=1,m.state=0,m.submitErrorCallback=k.onSubmitError,m.submitSuccessCallback=k.onSubmitSuccess,m.customMessageCallback=k.onCustomMessage,h.innerHTML='\x3ciframe id\x3d"'+m.frameId+'" name\x3d"'+m.frameId+'" frameborder\x3d"0" style\x3d"display:none" class\x3d"wirecard-seamless-frame"\x3e\x3c/iframe\x3e',(h=document.getElementById(m.formId))&&h.parentNode.removeChild(h),k.requestData.merchant_origin=G(),h=o({formId:m.formId,requestData:k.requestData,action:"https://api.wirecard.com:443/engine/rest/seamless/renderform",target:m.frameId}),document.body.appendChild(h),m.state=1,r("Seamless form render has timed out.",m,45),h.submit())}}else{p({loaderError:"Unable to find seamless form wrapping DIV.",wrappingDivId:k.wrappingDivId,errorCallback:k.onError})}}else{p({loaderError:"Unable to render seamless form. Missing input data.",errorCallback:k?k.onError:null})}},submitForm:function(h){if(h&&h.onSuccess&&h.onError){var k;if(h.wrappingDivId){if(!document.getElementById(h.wrappingDivId)){p({loaderError:"Unable to find seamless form wrapping DIV.",wrappingDivId:h.wrappingDivId,errorCallback:h.onError});return}k=n.getByWrappingDivId(h.wrappingDivId);if(!k){p({loaderError:"Seamless form must be successfully rendered before submit.",wrappingDivId:h.wrappingDivId,requestId:h.requestId,errorCallback:h.onError});return}}else{if(1<n.size()){p({loaderError:"Unable to identify seamless form. Please specify wrappingDivId",wrappingDivId:h.wrappingDivId,requestId:h.requestId,errorCallback:h.onError});return}if(0==n.size()){p({loaderError:"Seamless form must be successfully rendered before submit.",wrappingDivId:h.wrappingDivId,requestId:h.requestId,errorCallback:h.onError});return}k=n.getFirst()}if(2<k.step||2==k.step&&3!=k.state){p({loaderError:"Seamless form has already been submitted.",instance:k})}else{if(0==k.step||1==k.step&&2!=k.state){p({loaderError:"Seamless form must be successfully rendered before submit.",instance:k})}else{k.step=2;k.state=1;k.successCallback=h.onSuccess;k.errorCallback=h.onError;var m=document.getElementById(k.frameId);m&&m.contentWindow&&m.contentWindow.postMessage&&m.contentWindow.postMessage(JSON.stringify({WDEEMSG:{seamlessRequest:{operation:"seamlessSubmitForm",data:h.requestData?h.requestData:{}}}}),"https://api.wirecard.com:443");r("Seamless form submit has timed out.",k,45)}}}else{p({loaderError:"Unable to submit seamless form. Missing input data.",errorCallback:h?h.onError:null})}},pay:function(h){if(h&&h.requestData&&h.onSuccess&&h.onError){var k=new XMLHttpRequest;k.open("POST","https://api.wirecard.com:443/engine/rest/seamless/payments",!0);k.setRequestHeader("Content-Type","application/x-www-form-urlencoded");k.setRequestHeader("Accept","application/json");k.onreadystatechange=function(){if(4==k.readyState){if(200==k.status||201==k.status){var m=null;try{m=JSON.parse(k.responseText)}catch(u){m=s("Unable to parse response for payment request: "+h.requestData.request_id)}m&&m.paymentJson&&(m=m.paymentJson);"success"==m.transaction_state?h.onSuccess(m):h.onError(m)}else{m=s("Communication error when processing payment with request ID: "+h.requestData.request_id),h.onError(m)}}};k.send(b(h.requestData))}else{p({loaderError:"Missing input data for seamlessPay operation.",errorCallback:h?h.onError:null})}},changeLocale:function(h){h&&2<=h.length&&0<n.size()&&n.each(function(k){(k=document.getElementById(k.frameId))&&k.contentWindow&&k.contentWindow.postMessage&&k.contentWindow.postMessage(JSON.stringify({WDEEMSG:{seamlessRequest:{operation:"changeLocale",data:{locale:h}}}}),"https://api.wirecard.com:443")})},validate:function(h){q(h,"validate")},isValid:function(h){q(h,"isValid")}}}()})();